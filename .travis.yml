services:
- docker
env:
  global:
  - secure: rSFyOv6TW/cKH+TeZnylL5Fq15/Qp+3vO/IjrggB9bCrQnCkKPKS5FFuAMMlXOh75epjsG5lnvz6xS+Bvh1wrU59ryKMgUkDokVPW4VKu1oh9o4WcSnMW1+X6i479HwaC03yx7SDwwHr8NdGkxvuNrLoSTGHnHb02M/IMXNswkSlF3LZxTXQLH+WIUjD2PpjunW1y5gAGfsGpkcrPugsTafo1kuDYGm/OUAb7QgPvYe9WHMspMaazaIMhWzmjd4R0fTf5Zq7wdUQ35UnRkHRbgR1Ig3s05zKqkfBCHk2u/Zd/KiWNyUS1McsPH01iZ7jlQI5bqIlDvyHF5Dva1rAsWoPNqLugsZxUqIOZ96wGPYprjjrx1SgFjf5aa3wBC7X+UlcqQBB9OK/xMuuIk4CXMEVAEW5h0mt4BnFzWRkYXzBclzmN8Iq7ZAa2kkqyYkpPlP+1I/vBuUScyOTQtLK8p1ILeoq4mBUgh5Qngp3xEEY+fnenDpXtUaER8OAD9/0KeZFj7z3+eSWllox46fmyOmvqequwDaLk5ya8fjSQaFu3rPzCcnxuWfKO/x7gmRlLx+HeJ/3s3W6aH5m5mECrdCcgywPauuYUTW+KZTzOBdCgo7u72ZN4gYlK1IsRIqho9xvAAny1+pIQ3u926FEcy7cFFmS7iwTgZbiNpOJvwE=
  - secure: KUYcwqnIvPsvQPWxMJDwOliMQxEVRMapTsBZ4QU5u07P+/5+q3xF4km/cCzEOpbxlDpFFSUDZ2V6R+EI6A+jjErAv6D8w2zgGyOiurHkkfG3GRXEhWbppGP5MIMET4RsGb/5VNh93nOYRMmr26Ko7KYxSonmF3uzfn2aDbpzF1nXVW0NBBBmJDTeABedlkgJ0YOQyYclygTA8L15WRqztHM85mfY0l/225TJWdJj4yEO8Cy++zmhVd2F5rsqvP9UBhKZF1lUNzEAdLOmR3XFmqt7KaRXu4RVRQztic3P7KGPCENqcnuhPMajF7wE0qQWDZtOjUJ5KAY18VUrrdbHM8YxZGumLRwuuaEQpO8Tx+13EutmDBdShTnyhfer7NXrPMoIRRfN/qctEc7CntmhOs6SE4Anic2hDn+upOzFDfwQMaMzrfm4YuBENoSD5qO6gSmHcARSIteMj7az80tDZIWmm1JoEO2eBcv57p/0oQcR3JYxPx1RUe/ch/UR+7GgkX/7ErEqljBRuU0fV1xBUF3zAhRgjezMWqX8jLih1WrOm/hTysO4ZxoUjkxJzxPFEfQLaGflNZ8VSaGBOWncHJNZzdbsIJMfTwB4u/8iQT/Eem/ZwNYZIRTX66WSvsHgjUA5Y0CJ0jj3hGA+GmwdsnX5JJpAvZsuImo8TWEeR6w=
  - secure: NqnMU5AWemL6zW72MVeDX9ACtP7DDmVlwksAi/TCVlqaO3C6dyHe+x7xrpkRwUxOqZeTlP2O7PcX4GBKwshxTDnz7FP4Mu6egMHHovK6GZCVqDSGmktnr4YCnM5GD1k5ATlyZXZ7qtaUC8NdrAGlXXZSPpJu1kSIFNmKctkX89kNRmzVQeAj9EVZw4g/fp9QmK8/SC5BW1goV2IvTpRB+OHudeQ5XSqMAIWj4tSoJBr9NIZnzY+0873E4ogEngQI89b8rGuJZt5eEPszWM25Da0A7mLE0XCdCWEUblLoT32kQVlWhOcOLSxoQ+/urj3XYXFhIzLRexzxkPnQNQwLUUs7Wc0r+Iq8N+/rgn2oTrZXGo7jyWCHbzuwxO1S7T0vWsmHlPxrsh2ZYzeiZgpQXbYnPqG2MlZbq8b6NpIsl1ARv007UhPbrMIJ4FdKazYKLJ/gD7UWPat2pvdWC7moRc2bERw+952gI++gmGECkTMDF3S1W/BOQfV7n7GrUNeiqxTFWt8DvEfhCvWbHk8c9RFaTi/f5yNtpca0tgQVZkUu6qWivRgsDyevuQy+J2F5sqrARxQvZZICsgsWsSW0gD4mYbB9clIWfUK7q9Xaxt5c7fRYmRBXmZstyV7Kl+HPFXg0a/SyUnqxxUs3SiKTBCu1mvw12+1hsN5vbzvDzKE=
  - MONGO_DB_NAME=jack

script:
- docker build --tag todo-app:test --target test .
- docker run --env-file .env.test todo-app:test todo_app/tests
- docker run --env MONGO_DB_CONNECTION=$MONGO_DB_CONNECTION_SINGLE --env MONGO_DB_NAME todo-app:test todo_app/tests_e2e
- docker run --env MONGO_DB_CONNECTION=$MONGO_DB_CONNECTION_DOUBLE --env MONGO_DB_NAME todo-app:test todo_app/tests_e2e
- docker run --env MONGO_DB_CONNECTION=$MONGO_DB_CONNECTION_SINGLE_NO_DEFAULT --env MONGO_DB_NAME todo-app:test todo_app/tests_e2e