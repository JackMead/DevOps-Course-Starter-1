services:
- docker
env:
  global:
  - secure: rSFyOv6TW/cKH+TeZnylL5Fq15/Qp+3vO/IjrggB9bCrQnCkKPKS5FFuAMMlXOh75epjsG5lnvz6xS+Bvh1wrU59ryKMgUkDokVPW4VKu1oh9o4WcSnMW1+X6i479HwaC03yx7SDwwHr8NdGkxvuNrLoSTGHnHb02M/IMXNswkSlF3LZxTXQLH+WIUjD2PpjunW1y5gAGfsGpkcrPugsTafo1kuDYGm/OUAb7QgPvYe9WHMspMaazaIMhWzmjd4R0fTf5Zq7wdUQ35UnRkHRbgR1Ig3s05zKqkfBCHk2u/Zd/KiWNyUS1McsPH01iZ7jlQI5bqIlDvyHF5Dva1rAsWoPNqLugsZxUqIOZ96wGPYprjjrx1SgFjf5aa3wBC7X+UlcqQBB9OK/xMuuIk4CXMEVAEW5h0mt4BnFzWRkYXzBclzmN8Iq7ZAa2kkqyYkpPlP+1I/vBuUScyOTQtLK8p1ILeoq4mBUgh5Qngp3xEEY+fnenDpXtUaER8OAD9/0KeZFj7z3+eSWllox46fmyOmvqequwDaLk5ya8fjSQaFu3rPzCcnxuWfKO/x7gmRlLx+HeJ/3s3W6aH5m5mECrdCcgywPauuYUTW+KZTzOBdCgo7u72ZN4gYlK1IsRIqho9xvAAny1+pIQ3u926FEcy7cFFmS7iwTgZbiNpOJvwE=
  - secure: CGllC3b3FzFX4oMokIDIXDwLaAmGoB6oGb8s++5Kn4Sy+YgpSnImfkGPLneDySw7wtwTtn+knyr2xSiatK4BHmK6tICAIY/kQJXc+fjUQqaZrsGdBZRd5oO7gwPwD+KehBbF4XjpY8GjNu9taf/vRtoADVqlsTiUFbsTJ/oGOcsSZaJyckMTYQzsR/IkF79Ya4UVM9Y1Wou/y96j5LMbs5m0VXhLhXbukG/+IO8nbTLbLRxePzxcVuLsHzzG7XqjgK4E2TVYOD5lAfcxAEsU51ChJqvngrHzGLuGJEmQ7IkDvts3NMq5O03MSaAlf36lTZKMNzbCTaOJr8ztV31SUnx8N36QxwgdGA6fqf1uWwXVYMJvKAs6l7JYmSzQnSN7eG3S5IgOnm9rkU8zSs7zU+nRJjJ+HVnozQl44O/E4/1hZ6oTWh2JSsXX3BuJtE2id1EDRZIzM6XeT3xIWqV7Qx1bYs5ufmzeyTfOxcLR52Th3sQHvsBPeuhSna0s1OoKZp3ddVodb5bxJPqAHVGvnLnt9jOLCknGZhltlB9VesFiLE8BkqQM/YwTGaJRuvMO9Y79bVGUtSvBT96u2pVNJeVWLzLYZCPcn4Yyh1YTMqoCA+pMWa689OjBCarplD5Q0a11J+NhPkCQNTK2eByhWpeR/pXUH/z5LWm/oOKNYBo=
  - secure: NqnMU5AWemL6zW72MVeDX9ACtP7DDmVlwksAi/TCVlqaO3C6dyHe+x7xrpkRwUxOqZeTlP2O7PcX4GBKwshxTDnz7FP4Mu6egMHHovK6GZCVqDSGmktnr4YCnM5GD1k5ATlyZXZ7qtaUC8NdrAGlXXZSPpJu1kSIFNmKctkX89kNRmzVQeAj9EVZw4g/fp9QmK8/SC5BW1goV2IvTpRB+OHudeQ5XSqMAIWj4tSoJBr9NIZnzY+0873E4ogEngQI89b8rGuJZt5eEPszWM25Da0A7mLE0XCdCWEUblLoT32kQVlWhOcOLSxoQ+/urj3XYXFhIzLRexzxkPnQNQwLUUs7Wc0r+Iq8N+/rgn2oTrZXGo7jyWCHbzuwxO1S7T0vWsmHlPxrsh2ZYzeiZgpQXbYnPqG2MlZbq8b6NpIsl1ARv007UhPbrMIJ4FdKazYKLJ/gD7UWPat2pvdWC7moRc2bERw+952gI++gmGECkTMDF3S1W/BOQfV7n7GrUNeiqxTFWt8DvEfhCvWbHk8c9RFaTi/f5yNtpca0tgQVZkUu6qWivRgsDyevuQy+J2F5sqrARxQvZZICsgsWsSW0gD4mYbB9clIWfUK7q9Xaxt5c7fRYmRBXmZstyV7Kl+HPFXg0a/SyUnqxxUs3SiKTBCu1mvw12+1hsN5vbzvDzKE=
  - MONGO_DB_NAME=jack

script:
- docker build --tag todo-app:test --target test .
- docker run --env-file .env.test todo-app:test todo_app/tests
- docker run --env MONGO_DB_CONNECTION=$MONGO_DB_CONNECTION_SINGLE --env MONGO_DB_NAME todo-app:test todo_app/tests_e2e
- docker run --env MONGO_DB_CONNECTION=$MONGO_DB_CONNECTION_DOUBLE --env MONGO_DB_NAME todo-app:test todo_app/tests_e2e
- docker run --env MONGO_DB_CONNECTION=$MONGO_DB_CONNECTION_SINGLE_NO_DEFAULT --env MONGO_DB_NAME todo-app:test todo_app/tests_e2e