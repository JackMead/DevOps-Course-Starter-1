services:
- docker
env:
  global:
  
  - secure: ULzj8q+l66HeRAyOXu9k5988DXjrlEqS3sMBtSFxOA6JShm6MKqqj2/W3jFbAX6fz1ujpSuh6DCEjFMIAM3jZ+SHDWDwb7msww4LYDxtP/VMo66t2XpKgL1LbdEKNPYQAtbn4wAvDrUyOTtzFxnwcZEKd3NOlegX8ZjwJjuOLS9OmMUfFWPbD7a7Vt6W1MmqSj87oZu+Y2+XVUJnKGszNMZH2SoKvDXIVAbpgxwBR2Nkdmtc9SMU6eTDDhV1Hd4A7RG8pMqBle0P2/ifMqVP40cTA5WCGuydXyISdlneDAu3I0AL1Bg3Ksp/FyTcoI4k0QNvy82VeR5rDYtlHWiSI5HLaSatvYkfqwqq0z3RDprgmRGox37vGBkg3M6/fYw1Ep3flyXk3be3vbsxlQBtNcNDhxXHt//zHVatln3vx9lazJ5cIKJpSLz0i3xg4Xg/GkwTSdJcag7fqxh6jLkh7o43dWwpvKvV8KN5p8HmhQhvYGFqkM9hvxb07OKHWhdhy7vWmniLD9tANL99YQnkrYfDRKMxXluGF9+sFsNakyfCb5rsYqSd/9fPtsFtPnXzO/3w1XxZXVGZYi6xwASZY1/Tg1mY/1fxEWjW7QpjI2IY/kU97Me2u8nf2gI8MrwY0aHdjOb9WgGU1kf/m6RAX6uWJkxu5ACLdJnvUyMweLY=
  - secure: fRgFr1Ln70u4LumihjWGPnyDJ6aV1eMEsMRui1/sAJtGXfAJgooTHyiAZ8bt45GikbsRmJlXSuFbOnf+5gubF9BQBvdHYfpoYXGPXKclFPzBwMlGaO8XC5XsMXgVhlLocDIWZYfT1NVAKteu7KkgJ8zCc2bl9tWWxDN4NFkuEXeTSBmy1+BtC49agcLCcOqYP7s3UPOqouMT8Ubh6UPTesqnyQjpW4aXRrKE8QP8hqdNkohq2cL+MS4pwNLBRRzpMSfR+blrxR5wRP/iJMCskKg0e1Nrx7ND7UKjtpBhZqCKxuSLTJyR0nedkejxE13ZZ+wBtyJO+4shmCTAgGPaW7VYSCgZYWQzIdC14pMM+1SeK6MRBgOdGM/caOQ/DyCeONB2vAaOjUEBGikapQkkzyfi/kb2Y+kY/u9wvKIYnR/0wD7FohBK6d9SPnbzsiGnOB2lu8oVLbjdzUU9cdKuh5Ft/hwUdkmmIzsHlZ5Rlan5FF8ycORFaXRTd/9r/vtWIiuVzTokjM418Dix7/ZcYbEIuj4ZRVNYRp9xwu3ifSLDPZHfCN2kJLVhBWwP1vWlHSe+tbFFfgXbL8Nc1Pib/1WYfK0osjLtgWOX9AIXox7YS1gX+FoZTBZ9jY1pcIlnKfJAsOo81Y26GkveC2LS97AF1fB5ifBFk7GbGNRp00M=
  - secure: PibFR1FVG85JvDSxvRBGkCOImcff3twiKX5/5kVfTfXdon83Ce6R/DQ466AtRpcZ732Ob+H/UlIuGC1NlugwDZ8f587IUtbNYiU4qmScW+EzWzw35I7yAfI2SIyLgdt3zRFZFHEP6Ua/wj5PDk4bzw2O7HJb+X7CH6c+ex2nJhuzB0PGSRTiPUVNnenK1Bm0xCnouQC2KoEIH2Yq53zd7uF3OXzt8CJQRHckEAAY5FdYZNXuJYmXJk1HjE5j8POkOCbNCbG93KgSla5p+BZf2keYTV6sWWGtj6lHutIWQqtt6+EYxmeDJ1OF/GmhTGsXB/QlCcU+yJChjUsxaweMNv9/cHj82cZxJbCH2NLmiGMPv5+56Zpl5zlET01sP30MzFDl+8GwWB85KaQdZG67+SA55VTaMffyawxkq6jY3PUbIQrB4qq3ELTyrGvXO/8IITfrbB6hgYADZg/e51GVlwL79enPvbfcdtmv0rqDXOOv1iDhBu6qnx3Dfruw6qZZdJQnuROncOPjSafSsj4tdB7BUYgSZOU2qip7uqXg5XSHOcefZUPIUPtpA5A9bTFhetqwb8tUVFdSPDOWbmIoy5qZBAMptvCO45GHFaY6lZygNuOCKaSyhkxFmxXwgu1RyJl4J9PttbnJQ8agw96HpNrZb3fnvrX/0GoautEcT4s=
  - secure: IW9m3S7KDahmam8LsNvKLCqEZp+8vilkP/sQk5bh0SDmCjjI5+dRlzOcp5j4e8xaSebpRwDkj0/Ty8KNFNzBMEt55oiJQQdsNgGLgPUXRKcGGNn+7Pnyt++m117xaOwKBhSUDHwCX8WWF2TGgJSUO4SmCH4hmqFU2KudgB+QqGEUc5nkdMEd947gmEDoZzUAHaSxCjAmNBOsYW4wuPmpAYU8b2dirWKLRX8ME0H7r+MqLQhUh1RWmImVlxfPOggWnqo28M/fx2Pfrl/uFohzH4s3+XbgEhYBczs3GlJt+UgLiEwBm6AEE1hhZlEh0XoYNvNbw4Sshc6oKB/HMGPWmjQWOO5o5f8HxUq0tLpgqDgnSSWdQQFl9uESo0ZP7p+dTQnmT9mGSHqV74m98eZxKpRPfNePxgxPuOhP+INHyl71/3in4+kwQr21FUxMy9+L0S1s7jyiN1zFLnHiD0VTi8snXdmMwQAReiczzC7Dp/NwH/9oUSdn+vqURlWWnvkE8Q5el57OJcc98kddbhZhV2HSiFln2q9JgpO4qxB/tPJ77T19iBsQK2Yk2m38BO+G4BgsLGklRu8/h8Erh91S+fm8VHooYKLZ5M9bADeDVgOHNardbJ11h6qcXzGinfFjWQaKXZ7HHBVAfVm+cFhb4c9T7485CQAWC9Hi3FNRB/E=
  - secure: p9kevFuY4GqOyzCCB5he5j1yEph+xyrBavrG6bNFCJ4UclSSyT7d2qDmmEahaFf6rGVOxXQ86qJ1irSEZYgQZcJesDYB62Y4BHy90S5TbwX6GjND8BmcD51ovGeLAeeq1l75TN60big8OcBdX4xBV7xinbR0+GzligyfPKJD/esbm+eFsl8P7xIMzLfOaxoZMejPsouIZ++oZrpfmhyesUh5lJSHX+thBJl6f+DxHnfFvZIlhN3Ieg5BvY99dypl8l581NgJ8wXitYJHgBft7+ZhWaQvy3RYHfsd6fUBtvNeHwgZU+yXybx5Utex7SuYgC9bmyhdOTgkvNRsr0sMsD+sXVbhZiDNx3L82Dwo5jJuBGtm+yndZ6x5S6A6vpZfkhDLCt1j2JE2ZEckQUDxmoEWx1WsExEValnkMbCxQGyaIhVAexlAw8VuX9tixOWtm5ZhapzG3JAt4CuX29sGIXdqyLbCBtzOTtD7G1KPWyMdkomzllPPgiw8f3EcQslPml3Hfk6r1taYbZTiWaCB3jg8+JltEUBvmLzo29ZEFgPWdmK8rVxR8QXU0EnzvdwxL2UWMsdrqsUBScCZEo/JtgGEy4R3Jr1SGkmAxyxDyXGM1ht+OJe855XZbFCIKI+xsp7kzTTUitF/UuOMtmuCKDETBBIhmYMCbrpJs5j1IXY=
  - secure: Lmw2Yb/CBuaqqsdf3HtkoVdJY9Byd+XxyspGkLHxSml/zVSsbRv9n4uS0h9R49oEguSkgLXUCxLIaUCkUruaDR6Mmjc5Lo2xk1q/RZEcgcqA5HhwwMzcvdXcLfQS74Xv68j6FmWw2vV88MOXAIFSfVf63PrIymhw2Gb0mVYeaW+PI15tfDO2fkBhwglut2GQRT6v/QAiifvXaOpYb/wFYiX2Dc2lSwHbwiUBPXlsnQ3xchYnKznORNl7cleTnzDH6Ypjb1TmDVZK+V0Ns4QYu8x7nM0cAFMSoOLFWV8zwdQtkCXMVu87d0RTsUx/AWJZ2zLQwmZCZTmJaTnCAken1DVdSKgLebglRXd3A4LSYpCUpm49bPTzbBW+jTM9rwgZg6h7IkdAGUPlpSwlDsoCa2PKEJBmRgyz75pVNaWsYAwntxQPECmSGHSY16Q4X1wX3/WIrFVsnFC3cw+KuQJLy6jw6SC9kEfCdomm8qoCxTuSN9KQPguHYrqnj1oueKmlwQUFRRq5msiEDLzzDOc87+7CTMZBqtdsUSFr+MhOX9jX8IMbc/VunZPvgD6jT6000HoPHU7J8VUXWnExaiX3oNSt2adA/C3oqnVJUXdtN5lPqITdp7AmbnF6gaYo2LMVU9FQ2CdF+LyBc7J+pcJl+YsZDc6tBpATXT0+wGOawAc=
  - secure: JH/X/pTP7gZkFIk9a9VkyBzLq7Mys1zleg5+W/wVHQs9DaY53waJEvdNg/zhFEhfsf4Ep0b1vf6u2yHcw2GjUMHdbb97o3LpcrjCLoGiWM1QI7eUDhUhIxm3nIER8DOmQi+R7MBv8w8W27BhpKzZd0IqcQRZhhr7i2fwfhncJfVg8bEUYE0as+vG3oqcjm+K62nudzXp2fjqAB2C5Gbn7dcR+fG/wL6IEz6jqSsaYmAboHGsSi9ioU3k7RGVYQ7JYZ+TvImX5I/k/9oZNAgsTGMfn2rIRBEbkiU4j4aINbz3skApCy6ERo0xpz3Vkj9AKUr4X/UzUPD6gZVxY+Wwa+5oWQ+sbfZNEZzYQc34EIWZpc9eMjeE0p5djJEu01/At4Fg+p6XpFZRgwhQKG1pAYZ83PreGjm4FgpZ6deTblsI+A+X1rCLuK6PaEmmVBqsWF1J6jAj3LPlpOs/YF+4AXPMHj4vNNYBj34EAB/tpInuftGnpmTTa5eFbv6D5crzDkcdCpSP+5wRAhZ4XqDiQDgE2ZMcW+8gqFFsmwMGHYyPr2Xsl5aOHmvaWjaj0UjfjNJYPaByW8ua6IIxmWgXZqPXGUG7AndYqRAxnjgEzqwJCR+EmGyNjy9BkxPRLDDsz+Ck1SobHZfrBUK2jyDs7BOvEYuA/fpecd/NKuTa6U4=
  - secure: VY0u9qPNHgrOQzk/NLTvNrk/GWRatBPMMnueGSPWBwAnmgxoP+SBwmXvhXigoHf8udwFr/OIcH07nbyijGJRsk0fprE8P7+6GoDv58tNMzgUYUzqdZZ2bdTPJMicaQAJsDwjgtHH7jUM/+FJ7ZLaY0MZtaKP9TjFAlU805USVpoBgg2MnuI2EaXDS/S3SNrF8RKOkrJwBRC9VZkQ/H2S89i708xCUaQqRMyOgZyJtPOsSySTHeLxJ4riRicRKNCmcXWqtwaCElJJKbuFKCxjVg3CjCqqwQMykWdK6UxPkKYhoomQ53rmcJAazFNOhn9sWUYgl7+uREtJn3Zi/FFGO3NHpGB64NwJNUSslH0UMYkyd3SLinZWOGAtSXzhDyaBVlitx6Lbrj5hOKI7fRF++8dkama1ESKPxcB0UEa4reu5PxLc9ZP6ig9lyUlu2fT1H4rtkRwy8O+Qqai6q5ncqJlxu+MwVoJFCWYgvX7/2JMfn5oBecxh95Zapjad3dfncoM4X5QGLSBpJnXRw4eh2ZXjLFm29lQS/baQia3VIJoFgqD1fiGLFnjY6m7E46kFasferbB47Cm4XpJ1pWRYCohaMf3qn4cFP+Xfk559oqLG44yOdvf2QuVGdvSpLs8D5U27yw2VXoOBXmnla/7V7At9M2GhODi5anopBz1Krjg=

script:
- echo $DOCKER_PASSWORD | docker login --username $DOCKER_USERNAME --password-stdin
- docker build --tag todo-app:test --target test .
- docker run --env-file .env.test todo-app:test todo_app/tests
- docker run --env MONGO_DB_CONNECTION --env MONGO_DB_NAME todo-app:test todo_app/tests_e2e

before_deploy:
  - heroku container:login
  - docker build --tag $DOCKER_USERNAME/todo-production:latest --target production .
  - docker push $DOCKER_USERNAME/todo-production:latest
  - docker tag $DOCKER_USERNAME/todo-production:latest registry.heroku.com/lwtodoapp-production/web
  - docker push registry.heroku.com/lwtodoapp-production/web

deploy:
  provider: script
  script: heroku container:release --app lwtodoapp-production web
  on:
    branch: module11
