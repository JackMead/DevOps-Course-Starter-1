services:
- docker
env:
  global:
  - secure: rSFyOv6TW/cKH+TeZnylL5Fq15/Qp+3vO/IjrggB9bCrQnCkKPKS5FFuAMMlXOh75epjsG5lnvz6xS+Bvh1wrU59ryKMgUkDokVPW4VKu1oh9o4WcSnMW1+X6i479HwaC03yx7SDwwHr8NdGkxvuNrLoSTGHnHb02M/IMXNswkSlF3LZxTXQLH+WIUjD2PpjunW1y5gAGfsGpkcrPugsTafo1kuDYGm/OUAb7QgPvYe9WHMspMaazaIMhWzmjd4R0fTf5Zq7wdUQ35UnRkHRbgR1Ig3s05zKqkfBCHk2u/Zd/KiWNyUS1McsPH01iZ7jlQI5bqIlDvyHF5Dva1rAsWoPNqLugsZxUqIOZ96wGPYprjjrx1SgFjf5aa3wBC7X+UlcqQBB9OK/xMuuIk4CXMEVAEW5h0mt4BnFzWRkYXzBclzmN8Iq7ZAa2kkqyYkpPlP+1I/vBuUScyOTQtLK8p1ILeoq4mBUgh5Qngp3xEEY+fnenDpXtUaER8OAD9/0KeZFj7z3+eSWllox46fmyOmvqequwDaLk5ya8fjSQaFu3rPzCcnxuWfKO/x7gmRlLx+HeJ/3s3W6aH5m5mECrdCcgywPauuYUTW+KZTzOBdCgo7u72ZN4gYlK1IsRIqho9xvAAny1+pIQ3u926FEcy7cFFmS7iwTgZbiNpOJvwE=
  - secure: mVen7CLQTg3OPxCxpQ3QZ6xqXcFPER876nINzHA3zj/M1eB9R7oTKKo2l7D6EdnzZxnnrOMxuSt8GrMZx43CBESXFMTK2sYc009s1297aAWasdc1uTLweN+9pzKm1zGJriNe1n7uAxlmOdpscuDAwyCtv7/jGa8c/Cew/mmXCqGGpz2ByBo0F25jHr7kOa6UWta+Dln36Yg3WdVpEhy1kfYwkp8wkN7u5XJJAnOmnEdc845iB8J3YSh460d3kWKL7LmnmyzVYojbYYf2vGR12wYk7RHPYP8/XwsRXAGjUPQOgoABdk8WuztGBgMq0/rxI41tFYNfaz2x31IwGrMIU/vmTWzl8vIO4a0iOtV1EwUx9eLDV4WUSAc3ii597Kxc0cZ+X0aYzlErQY0YF47CpMefBBLMIVrbZrcfItVcTDDYTUHfjuYD5owyzBVjFKK0T4lsxj4byChjwJRpJ84bXsG2JcFzoWd76HG11bBMTBCw/3rucVw6pNTotCuGUDp5SOH0dgMlCaf5arN8LirxdGy1jwNr05+issHT93XsMKDV1zmD8ZDVPYsXwNsRexTxhtWKLk2E/ZqAEtNwdeT19bebh5eOVnOLC/yYmX0RY26JHzdRSDn9qAqseC0PpN+Ht2l10egBD33/9gjLZIvsjb8fVqBRIMuNomyqD+20dAk=
  - secure: NqnMU5AWemL6zW72MVeDX9ACtP7DDmVlwksAi/TCVlqaO3C6dyHe+x7xrpkRwUxOqZeTlP2O7PcX4GBKwshxTDnz7FP4Mu6egMHHovK6GZCVqDSGmktnr4YCnM5GD1k5ATlyZXZ7qtaUC8NdrAGlXXZSPpJu1kSIFNmKctkX89kNRmzVQeAj9EVZw4g/fp9QmK8/SC5BW1goV2IvTpRB+OHudeQ5XSqMAIWj4tSoJBr9NIZnzY+0873E4ogEngQI89b8rGuJZt5eEPszWM25Da0A7mLE0XCdCWEUblLoT32kQVlWhOcOLSxoQ+/urj3XYXFhIzLRexzxkPnQNQwLUUs7Wc0r+Iq8N+/rgn2oTrZXGo7jyWCHbzuwxO1S7T0vWsmHlPxrsh2ZYzeiZgpQXbYnPqG2MlZbq8b6NpIsl1ARv007UhPbrMIJ4FdKazYKLJ/gD7UWPat2pvdWC7moRc2bERw+952gI++gmGECkTMDF3S1W/BOQfV7n7GrUNeiqxTFWt8DvEfhCvWbHk8c9RFaTi/f5yNtpca0tgQVZkUu6qWivRgsDyevuQy+J2F5sqrARxQvZZICsgsWsSW0gD4mYbB9clIWfUK7q9Xaxt5c7fRYmRBXmZstyV7Kl+HPFXg0a/SyUnqxxUs3SiKTBCu1mvw12+1hsN5vbzvDzKE=
  - MONGO_DB_NAME=jack

script:
- docker build --tag todo-app:test --target test .
- docker run --env-file .env.test todo-app:test todo_app/tests
- docker run --env MONGO_DB_CONNECTION=$MONGO_DB_CONNECTION_SINGLE --env MONGO_DB_NAME todo-app:test todo_app/tests_e2e
- docker run --env MONGO_DB_CONNECTION=$MONGO_DB_CONNECTION_DOUBLE --env MONGO_DB_NAME todo-app:test todo_app/tests_e2e
- docker run --env MONGO_DB_CONNECTION=$MONGO_DB_CONNECTION_SINGLE_NO_DEFAULT --env MONGO_DB_NAME todo-app:test todo_app/tests_e2e